<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #337ecc;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #409eff;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            border-left-color: #f56c6c;
            background: #fef0f0;
        }
        .success {
            border-left-color: #67c23a;
            background: #f0f9ff;
        }
    </style>
</head>
<body>
    <h1>🧪 知识库API测试工具</h1>
    
    <div class="test-section">
        <h3>📊 测试元数据API</h3>
        <button onclick="testMetadata()">获取元数据</button>
        <div id="metadataResult" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h3>📚 测试知识库数据API</h3>
        <button onclick="testKnowledgeBase()">获取知识库数据</button>
        <div id="knowledgeBaseResult" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h3>➕ 测试添加内容API</h3>
        <button onclick="testAddContent()">添加测试内容</button>
        <div id="addContentResult" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h3>🔍 服务器状态检查</h3>
        <button onclick="checkServer()">检查服务器连接</button>
        <div id="serverResult" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        async function testMetadata() {
            const resultDiv = document.getElementById('metadataResult');
            resultDiv.style.display = 'block';
            
            try {
                const response = await fetch(API_BASE + '/metadata');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ 元数据获取成功:\n' + JSON.stringify(data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = '❌ 元数据获取失败:\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 网络错误:\n' + error.message;
            }
        }
        
        async function testKnowledgeBase() {
            const resultDiv = document.getElementById('knowledgeBaseResult');
            resultDiv.style.display = 'block';
            
            try {
                const response = await fetch(API_BASE + '/knowledge-base');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ 知识库数据获取成功:\n' + JSON.stringify(data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = '❌ 知识库数据获取失败:\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 网络错误:\n' + error.message;
            }
        }
        
        async function testAddContent() {
            const resultDiv = document.getElementById('addContentResult');
            resultDiv.style.display = 'block';
            
            const testData = {
                timePoint: '2025年12月第4周',
                industry: '人工智能',
                title: 'API测试内容',
                summary: '这是一个API测试用的内容摘要',
                importance: 'medium',
                tags: ['测试', 'API'],
                detailContent: '# API测试内容\n\n这是测试用的详细内容。\n\n- 测试项1\n- 测试项2'
            };
            
            try {
                const response = await fetch(API_BASE + '/add-content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ 内容添加成功:\n' + JSON.stringify(data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = '❌ 内容添加失败:\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 网络错误:\n' + error.message;
            }
        }
        
        async function checkServer() {
            const resultDiv = document.getElementById('serverResult');
            resultDiv.style.display = 'block';
            
            try {
                const response = await fetch('http://localhost:3000/');
                const text = await response.text();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ 服务器运行正常:\n状态码: ' + response.status + '\n响应: ' + text.substring(0, 200);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = '❌ 服务器响应异常:\n状态码: ' + response.status;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 无法连接到服务器:\n' + error.message + '\n\n请确保服务器正在运行 (node server/app.js)';
            }
        }
    </script>
</body>
</html> 