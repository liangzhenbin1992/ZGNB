<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>思路方法论管理工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            color: #2c3e50;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }
        
        .form-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        textarea {
            height: 400px;
            resize: vertical;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 12px 12px;
            font-size: 15px;
            line-height: 1.6;
            background: linear-gradient(135deg, #fafbfc 0%, #f8f9fa 100%);
            transition: all 0.3s ease;
            box-shadow: inset 0 3px 6px rgba(102, 126, 234, 0.05);
            padding: 20px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #764ba2;
            background: white;
            box-shadow: inset 0 3px 6px rgba(102, 126, 234, 0.05), 0 0 0 3px rgba(102, 126, 234, 0.15);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .alert-success {
            background: rgba(72, 187, 120, 0.1);
            border: 2px solid #48bb78;
            color: #22543d;
        }
        
        .alert-error {
            background: rgba(245, 101, 101, 0.1);
            border: 2px solid #f56565;
            color: #742a2a;
        }
        
        .alert-info {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            color: #2d3748;
        }
        
        .existing-content {
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
        }
        
        .content-item {
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .content-item:hover {
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .content-item.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .content-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .content-meta {
            font-size: 12px;
            color: #718096;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .difficulty-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .difficulty-beginner {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .difficulty-intermediate {
            background: #fef5e7;
            color: #744210;
        }
        
        .difficulty-advanced {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 8px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            min-height: 40px;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tag-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .tag-remove:hover {
            opacity: 1;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .category-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .category-option {
            padding: 10px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            font-size: 12px;
        }
        
        .category-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .category-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 0%;
            transition: width 0.3s;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }
        
        .stat-number {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #718096;
        }
        
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
            }
        }
        
        /* 增强编辑器工具栏样式 - 方法论专用 */
        .editor-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid #667eea;
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            margin-bottom: 0;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }
        
        .toolbar-group {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .toolbar-section {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .toolbar-label {
            font-size: 10px;
            color: #667eea;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            text-align: center;
            margin-bottom: 3px;
        }
        
        .toolbar-section .toolbar-btn {
            display: flex;
            gap: 4px;
        }
        
        .toolbar-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 12px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .toolbar-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .toolbar-btn:active {
            transform: translateY(-1px);
        }
        
        .toolbar-btn-image {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border-color: #48bb78;
        }
        
        .toolbar-btn-image:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            box-shadow: 0 8px 24px rgba(72, 187, 120, 0.5);
        }
        
        .toolbar-btn-preview {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-color: #8b5cf6;
        }
        
        .toolbar-btn-preview:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.5);
        }
        
        /* 方法论专用模板栏样式 */
        .template-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 18px;
            background: rgba(102, 126, 234, 0.08);
            border: 2px solid #e2e8f0;
            border-top: none;
            border-bottom: none;
            flex-wrap: wrap;
        }
        
        .template-label {
            font-size: 13px;
            color: #667eea;
            font-weight: 700;
            margin-right: 10px;
        }
        
        .template-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }
        
        .template-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* 方法论预览区域增强样式 */
        .preview-section {
            background: white !important;
            border: 2px solid #667eea !important;
            border-radius: 0 0 12px 12px !important;
            padding: 25px !important;
            margin-top: 0 !important;
            margin-bottom: 20px !important;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15) !important;
        }
        
        .preview-content {
            max-height: 600px !important;
            overflow-y: auto !important;
            padding: 20px !important;
            background: linear-gradient(135deg, #fafbfc 0%, #f8f9fa 100%) !important;
            border-radius: 12px !important;
            border: 2px solid rgba(102, 126, 234, 0.1) !important;
            font-family: system-ui, -apple-system, sans-serif !important;
            line-height: 1.8 !important;
        }
        
        .preview-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
            border: 2px solid rgba(102, 126, 234, 0.1);
        }
        
        .preview-content table th,
        .preview-content table td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            color: #2c3e50;
        }
        
        .preview-content table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 0.5px;
        }
        
        .preview-content table tr:nth-child(even) {
            background: rgba(102, 126, 234, 0.03);
        }
        
        .preview-content table tr:hover {
            background: rgba(102, 126, 234, 0.08);
            transform: scale(1.002);
            transition: all 0.2s ease;
        }
        
        .preview-content ul,
        .preview-content ol {
            margin: 20px 0;
            padding-left: 30px;
        }
        
        .preview-content li {
            margin: 10px 0 !important;
            line-height: 1.7;
            color: #2c3e50;
        }
        
        /* 图片预览区域 */
        .image-preview-area {
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(102, 126, 234, 0.1);
            border-bottom: 1px solid #e1e8ed;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            color: #2d3748;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #64748b;
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #f56565;
            color: white;
            transform: scale(1.1);
        }
        
        .preview-content {
            padding: 20px;
            text-align: center;
        }
        
        .preview-content img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .preview-actions {
            padding: 12px 16px;
            border-top: 1px solid #e1e8ed;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* 调整textarea样式 */
        #detailContent {
            border-radius: 0 0 8px 8px;
            border-top: none;
            background: rgba(255, 255, 255, 0.9);
        }
        
        /* 图片插入提示 */
        .image-insert-hint {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            color: #2d3748;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 12px;
            margin-bottom: 12px;
            backdrop-filter: blur(5px);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .category-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .editor-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .toolbar-group {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .preview-content img {
                max-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💡 思路方法论管理工具</h1>
            <p>专业管理你的思维框架、分析方法和实践经验</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="alert alert-success" id="successAlert"></div>
        <div class="alert alert-error" id="errorAlert"></div>
        <div class="alert alert-info" id="infoAlert"></div>
        
        <div class="content-grid">
            <!-- 主表单区域 -->
            <div class="form-section">
                <h2 id="formTitle">📝 添加新方法论</h2>
                
                <div class="quick-actions">
                    <button class="btn" onclick="clearForm()">🗑️ 清空表单</button>
                    <button class="btn btn-warning" onclick="generateSample()">🎲 生成示例</button>
                    <button class="btn" onclick="importFromTemplate()">📋 导入模板</button>
                </div>
                
                <form id="methodologyForm">
                    <div class="form-group">
                        <label for="category">🗂️ 分类</label>
                        <div class="category-selector" id="categorySelector">
                            <!-- 分类选项将通过JavaScript生成 -->
                        </div>
                        <input type="text" id="customCategory" placeholder="或输入自定义分类..." style="margin-top: 10px;">
                    </div>
                    
                    <div class="form-group">
                        <label for="title">📄 标题</label>
                        <input type="text" id="title" placeholder="输入方法论标题..." required>
                    </div>
                    
                    <div class="form-group">
                        <label for="summary">📋 摘要</label>
                        <textarea id="summary" placeholder="简要描述这个方法论的核心内容..." required style="height: 80px;"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="difficulty">⭐ 难度等级</label>
                            <select id="difficulty" required>
                                <option value="beginner">🟢 入门级</option>
                                <option value="intermediate" selected>🟡 中级</option>
                                <option value="advanced">🔴 高级</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="rating">📊 推荐指数</label>
                            <select id="rating">
                                <option value="3">⭐⭐⭐ (3星)</option>
                                <option value="3.5">⭐⭐⭐⭐ (3.5星)</option>
                                <option value="4" selected>⭐⭐⭐⭐ (4星)</option>
                                <option value="4.5">⭐⭐⭐⭐⭐ (4.5星)</option>
                                <option value="5">⭐⭐⭐⭐⭐ (5星)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="tags">🏷️ 标签</label>
                        <div class="tags-input" id="tagsContainer">
                            <input type="text" id="tagInput" placeholder="输入标签并按回车..." style="border: none; outline: none; flex: 1; min-width: 120px; background: transparent;">
                        </div>
                        <small style="color: #718096; margin-top: 5px; display: block;">
                            💡 建议添加关键词标签，如：产品规划、用户体验、数据分析等
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="detailContent">📝 详细内容 (Markdown格式)</label>
                        
                        <!-- 增强编辑工具栏 -->
                        <div class="editor-toolbar">
                            <div class="toolbar-group">
                                <div class="toolbar-section">
                                    <span class="toolbar-label">标题</span>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('# ', '')" title="一级标题">H1</button>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('## ', '')" title="二级标题">H2</button>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('### ', '')" title="三级标题">H3</button>
                                </div>
                            </div>
                            
                            <div class="toolbar-group">
                                <div class="toolbar-section">
                                    <span class="toolbar-label">格式</span>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('**', '**')" title="粗体">
                                        <b>B</b>
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('*', '*')" title="斜体">
                                        <i>I</i>
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('~~', '~~')" title="删除线">
                                        <s>S</s>
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('`', '`')" title="代码">
                                        &lt;/&gt;
                                    </button>
                                </div>
                            </div>
                            
                            <div class="toolbar-group">
                                <div class="toolbar-section">
                                    <span class="toolbar-label">列表</span>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('- ', '')" title="无序列表">
                                        •
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertOrderedList()" title="有序列表">
                                        1.
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('- [ ] ', '')" title="任务列表">
                                        ☑️
                                    </button>
                                </div>
                            </div>
                            
                            <div class="toolbar-group">
                                <div class="toolbar-section">
                                    <span class="toolbar-label">引用</span>
                                    <button type="button" class="toolbar-btn" onclick="insertMarkdown('> ', '')" title="引用">
                                        "
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertCodeBlock()" title="代码块">
                                        { }
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertTable()" title="表格">
                                        ⊞
                                    </button>
                                </div>
                            </div>
                            
                            <div class="toolbar-group">
                                <div class="toolbar-section">
                                    <span class="toolbar-label">媒体</span>
                                    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                                    <button type="button" class="toolbar-btn toolbar-btn-image" onclick="document.getElementById('imageUpload').click()" title="插入图片">
                                        📷
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertImageUrl()" title="图片链接">
                                        🔗
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertLink()" title="插入链接">
                                        🌐
                                    </button>
                                </div>
                            </div>
                            
                            <div class="toolbar-group">
                                <div class="toolbar-section">
                                    <span class="toolbar-label">操作</span>
                                    <button type="button" class="toolbar-btn" onclick="insertSeparator()" title="分隔线">
                                        ➖
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertEmoji()" title="表情">
                                        😊
                                    </button>
                                    <button type="button" class="toolbar-btn toolbar-btn-preview" onclick="togglePreview()" title="实时预览">
                                        👁️
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 方法论专用模板 -->
                        <div class="template-bar">
                            <span class="template-label">🧠 方法论模板:</span>
                            <button type="button" class="template-btn" onclick="insertMethodologyTemplate('framework')">🏗️ 框架</button>
                            <button type="button" class="template-btn" onclick="insertMethodologyTemplate('process')">⚙️ 流程</button>
                            <button type="button" class="template-btn" onclick="insertMethodologyTemplate('analysis')">🔍 分析</button>
                            <button type="button" class="template-btn" onclick="insertMethodologyTemplate('design')">🎨 设计</button>
                            <button type="button" class="template-btn" onclick="insertMethodologyTemplate('management')">📊 管理</button>
                        </div>
                        
                        <!-- 图片预览区域 -->
                        <div id="imagePreviewArea" class="image-preview-area" style="display: none;">
                            <div class="preview-header">
                                <span>📷 图片预览</span>
                                <button type="button" onclick="closeImagePreview()" class="close-btn">×</button>
                            </div>
                            <div id="imagePreviewContent" class="preview-content"></div>
                            <div class="preview-actions">
                                <button type="button" class="btn btn-success" onclick="insertSelectedImage()">插入图片</button>
                                <button type="button" class="btn" onclick="closeImagePreview()">取消</button>
                            </div>
                        </div>
                        
                        <textarea id="detailContent" placeholder="# 方法论标题

## 概述
简要描述这个方法论...

## 适用场景
- 场景一：...
- 场景二：...

## 核心步骤

### 步骤1：准备阶段
详细描述...

### 步骤2：执行阶段
详细描述...

### 步骤3：评估阶段
详细描述...

## 实践案例
具体案例说明...

![案例图片](图片URL)

## 注意事项
- 注意事项1
- 注意事项2

## 相关资源
- 推荐阅读1
- 推荐工具2"></textarea>
                    </div>
                    
                    <div class="quick-actions">
                        <button type="submit" class="btn btn-success">💾 保存方法论</button>
                        <button type="button" class="btn btn-warning" onclick="updateMethodology()" id="updateBtn" style="display: none;">✏️ 更新内容</button>
                        <button type="button" class="btn btn-danger" onclick="deleteMethodology()" id="deleteBtn" style="display: none;">🗑️ 删除</button>
                    </div>
                </form>
            </div>
            
            <!-- 侧边栏 -->
            <div class="sidebar">
                <h3>📊 统计信息</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalCount">0</div>
                        <div class="stat-label">总方法论</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="categoryCount">0</div>
                        <div class="stat-label">分类数</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="avgRating">0</div>
                        <div class="stat-label">平均评分</div>
                    </div>
                </div>
                
                <hr style="margin: 20px 0; border: none; height: 1px; background: #e1e8ed;">
                
                <h3>📚 现有方法论</h3>
                <div class="form-group">
                    <input type="text" id="searchContent" placeholder="搜索方法论..." onInput="filterContent()">
                </div>
                <div class="existing-content" id="existingContent">
                    <div style="text-align: center; padding: 20px; color: #718096;">正在加载...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let methodologies = [];
        let categories = [];
        let selectedMethodology = null;
        let isEditMode = false;
        
        const defaultCategories = [
            '产品设计', '技术架构', '管理方法', '分析框架',
            '创新思维', '商业模式', '用户研究', '数据分析'
        ];
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });
        
        async function initializePage() {
            setupTagInput();
            setupForm();
            await loadMethodologies();
            generateCategorySelector();
        }
        
        // 加载方法论数据
        async function loadMethodologies() {
            try {
                updateProgress(30);
                const response = await fetch('http://localhost:3000/api/methodologies');
                const data = await response.json();
                
                methodologies = data.methodologies || [];
                categories = data.categories || defaultCategories;
                
                updateProgress(70);
                displayMethodologies();
                updateStats();
                updateProgress(100);
                
                setTimeout(() => updateProgress(0), 1000);
            } catch (error) {
                console.error('加载方法论失败:', error);
                showAlert('连接服务器失败，使用离线模式', 'error');
                
                // 使用默认数据
                categories = defaultCategories;
                methodologies = getSampleData();
                displayMethodologies();
                updateStats();
                updateProgress(0);
            }
        }
        
        // 生成分类选择器
        function generateCategorySelector() {
            const container = document.getElementById('categorySelector');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const option = document.createElement('div');
                option.className = 'category-option';
                option.textContent = category;
                option.onclick = () => selectCategory(option, category);
                container.appendChild(option);
            });
        }
        
        // 选择分类
        function selectCategory(element, category) {
            // 移除其他选中状态
            document.querySelectorAll('.category-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // 设置选中状态
            element.classList.add('selected');
            
            // 清空自定义分类输入
            document.getElementById('customCategory').value = '';
        }
        
        // 获取选中的分类
        function getSelectedCategory() {
            const selectedElement = document.querySelector('.category-option.selected');
            if (selectedElement) {
                return selectedElement.textContent;
            }
            
            const customCategory = document.getElementById('customCategory').value.trim();
            if (customCategory) {
                return customCategory;
            }
            
            return '';
        }
        
        // 显示方法论列表
        function displayMethodologies() {
            const container = document.getElementById('existingContent');
            container.innerHTML = '';
            
            if (methodologies.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #718096;">暂无方法论</div>';
                return;
            }
            
            methodologies.forEach(methodology => {
                const item = createMethodologyItem(methodology);
                container.appendChild(item);
            });
        }
        
        // 创建方法论项
        function createMethodologyItem(methodology) {
            const item = document.createElement('div');
            item.className = 'content-item';
            item.onclick = () => selectMethodology(methodology, item);
            
            const difficultyClass = `difficulty-${methodology.difficulty}`;
            const difficultyLabel = {
                'beginner': '入门',
                'intermediate': '中级',
                'advanced': '高级'
            }[methodology.difficulty] || '未知';
            
            item.innerHTML = `
                <div class="content-title">${methodology.title}</div>
                <div class="content-meta">
                    <span>${methodology.category}</span>
                    <span class="difficulty-badge ${difficultyClass}">${difficultyLabel}</span>
                </div>
            `;
            
            return item;
        }
        
        // 选择方法论
        function selectMethodology(methodology, element) {
            // 移除其他选中状态
            document.querySelectorAll('.content-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // 设置选中状态
            element.classList.add('selected');
            selectedMethodology = methodology;
            
            // 填充表单
            fillForm(methodology);
            
            // 切换到编辑模式
            switchToEditMode();
        }
        
        // 填充表单
        async function fillForm(methodology) {
            // 选择分类
            document.querySelectorAll('.category-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.textContent === methodology.category) {
                    opt.classList.add('selected');
                }
            });
            
            document.getElementById('title').value = methodology.title;
            document.getElementById('summary').value = methodology.summary;
            document.getElementById('difficulty').value = methodology.difficulty;
            document.getElementById('rating').value = methodology.rating || 4;
            
            // 清空并重新添加标签
            clearTags();
            if (methodology.tags) {
                methodology.tags.forEach(tag => addTag(tag));
            }
            
            // 加载详细内容
            await loadMethodologyDetail(methodology.id);
        }
        
        // 加载方法论详情
        async function loadMethodologyDetail(id) {
            try {
                const response = await fetch(`http://localhost:3000/api/methodology-detail/${id}`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('detailContent').value = data.content;
                } else {
                    document.getElementById('detailContent').value = '';
                }
            } catch (error) {
                console.error('加载详细内容失败:', error);
                document.getElementById('detailContent').value = '';
            }
        }
        
        // 设置标签输入
        function setupTagInput() {
            const tagInput = document.getElementById('tagInput');
            tagInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const tag = this.value.trim();
                    if (tag) {
                        addTag(tag);
                        this.value = '';
                    }
                }
            });
        }
        
        // 添加标签
        function addTag(tagText) {
            const container = document.getElementById('tagsContainer');
            const tagInput = document.getElementById('tagInput');
            
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = `${tagText}<button type="button" class="tag-remove" onclick="removeTag(this)">×</button>`;
            
            container.insertBefore(tag, tagInput);
        }
        
        // 移除标签
        function removeTag(button) {
            button.parentElement.remove();
        }
        
        // 清空标签
        function clearTags() {
            const tags = document.querySelectorAll('.tag');
            tags.forEach(tag => tag.remove());
        }
        
        // 获取所有标签
        function getTags() {
            const tags = document.querySelectorAll('.tag');
            return Array.from(tags).map(tag => tag.textContent.replace('×', '').trim());
        }
        
        // 设置表单提交
        function setupForm() {
            document.getElementById('methodologyForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addMethodology();
            });
        }
        
        // 添加方法论
        async function addMethodology() {
            const formData = getFormData();
            if (!validateFormData(formData)) return;
            
            try {
                updateProgress(30);
                showAlert('正在保存方法论...', 'info');
                
                const response = await fetch('http://localhost:3000/api/add-methodology', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                updateProgress(70);
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('方法论添加成功！', 'success');
                    await loadMethodologies();
                    generateCategorySelector();
                    updateProgress(100);
                    
                    setTimeout(() => {
                        updateProgress(0);
                        if (confirm('方法论已添加成功！是否清空表单继续添加？')) {
                            clearForm();
                        }
                    }, 2000);
                } else {
                    throw new Error(result.error || '添加失败');
                }
            } catch (error) {
                showAlert('添加方法论失败: ' + error.message, 'error');
                updateProgress(0);
            }
        }
        
        // 更新方法论
        async function updateMethodology() {
            if (!selectedMethodology) return;
            
            const formData = getFormData();
            if (!validateFormData(formData)) return;
            
            try {
                updateProgress(30);
                showAlert('正在更新方法论...', 'info');
                
                const response = await fetch(`http://localhost:3000/api/update-methodology/${selectedMethodology.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                updateProgress(70);
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('方法论更新成功！', 'success');
                    await loadMethodologies();
                    generateCategorySelector();
                    switchToAddMode();
                    clearForm();
                    updateProgress(100);
                    setTimeout(() => updateProgress(0), 1000);
                } else {
                    throw new Error(result.error || '更新失败');
                }
            } catch (error) {
                showAlert('更新方法论失败: ' + error.message, 'error');
                updateProgress(0);
            }
        }
        
        // 删除方法论
        async function deleteMethodology() {
            if (!selectedMethodology) return;
            
            if (!confirm('确定要删除这个方法论吗？此操作不可恢复。')) return;
            
            try {
                updateProgress(30);
                showAlert('正在删除方法论...', 'info');
                
                const response = await fetch(`http://localhost:3000/api/delete-methodology/${selectedMethodology.id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                updateProgress(70);
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('方法论删除成功！', 'success');
                    await loadMethodologies();
                    generateCategorySelector();
                    switchToAddMode();
                    clearForm();
                    updateProgress(100);
                    setTimeout(() => updateProgress(0), 1000);
                } else {
                    throw new Error(result.error || '删除失败');
                }
            } catch (error) {
                showAlert('删除方法论失败: ' + error.message, 'error');
                updateProgress(0);
            }
        }
        
        // 获取表单数据
        function getFormData() {
            return {
                category: getSelectedCategory(),
                title: document.getElementById('title').value.trim(),
                summary: document.getElementById('summary').value.trim(),
                difficulty: document.getElementById('difficulty').value,
                rating: parseFloat(document.getElementById('rating').value),
                tags: getTags(),
                content: document.getElementById('detailContent').value.trim()
            };
        }
        
        // 验证表单数据
        function validateFormData(data) {
            if (!data.category) {
                showAlert('请选择或输入分类', 'error');
                return false;
            }
            if (!data.title) {
                showAlert('请输入标题', 'error');
                return false;
            }
            if (!data.summary) {
                showAlert('请输入摘要', 'error');
                return false;
            }
            if (!data.content) {
                showAlert('请输入详细内容', 'error');
                return false;
            }
            return true;
        }
        
        // 切换到编辑模式
        function switchToEditMode() {
            isEditMode = true;
            document.getElementById('formTitle').textContent = '✏️ 编辑方法论';
            document.getElementById('updateBtn').style.display = 'inline-block';
            document.getElementById('deleteBtn').style.display = 'inline-block';
            document.querySelector('button[type="submit"]').style.display = 'none';
        }
        
        // 切换到添加模式
        function switchToAddMode() {
            isEditMode = false;
            selectedMethodology = null;
            document.getElementById('formTitle').textContent = '📝 添加新方法论';
            document.getElementById('updateBtn').style.display = 'none';
            document.getElementById('deleteBtn').style.display = 'none';
            document.querySelector('button[type="submit"]').style.display = 'inline-block';
            
            // 移除选中状态
            document.querySelectorAll('.content-item').forEach(item => {
                item.classList.remove('selected');
            });
        }
        
        // 清空表单
        function clearForm() {
            document.getElementById('methodologyForm').reset();
            document.querySelectorAll('.category-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.getElementById('customCategory').value = '';
            clearTags();
            switchToAddMode();
        }
        
        // 生成示例数据
        function generateSample() {
            clearForm();
            
            const samples = [
                {
                    category: '产品设计',
                    title: '用户故事地图方法',
                    summary: '通过用户故事地图来梳理产品功能优先级和用户旅程的系统性方法',
                    difficulty: 'intermediate',
                    tags: ['用户体验', '产品规划', '敏捷开发'],
                    content: `# 用户故事地图方法

## 概述
用户故事地图是一种可视化工具，帮助团队理解用户需求和产品功能的优先级。

## 适用场景
- 产品规划阶段
- 功能优先级排序
- 团队对齐产品愿景

## 核心步骤

### 步骤1：识别用户活动
列出用户要完成的主要活动和任务

### 步骤2：编写用户故事
为每个活动编写具体的用户故事

### 步骤3：排列优先级
按照用户价值和业务价值排序

## 实践案例
电商网站的用户故事地图制作过程...

## 注意事项
- 保持用户视角
- 定期更新和维护
- 团队协作完成`
                },
                {
                    category: '分析框架',
                    title: 'SWOT分析法',
                    summary: '系统分析优势、劣势、机会、威胁的经典战略分析工具',
                    difficulty: 'beginner',
                    tags: ['战略分析', '决策工具', '竞争分析'],
                    content: `# SWOT分析法

## 概述
SWOT分析是一种战略规划工具，帮助组织识别内部优势劣势和外部机会威胁。

## 适用场景
- 战略规划
- 项目评估
- 竞争分析

## 核心步骤

### 步骤1：识别优势(Strengths)
分析内部的积极因素

### 步骤2：识别劣势(Weaknesses)
分析内部的消极因素

### 步骤3：识别机会(Opportunities)
分析外部的积极因素

### 步骤4：识别威胁(Threats)
分析外部的消极因素

## 实践案例
某公司进入新市场的SWOT分析...

## 注意事项
- 保持客观性
- 定期更新分析
- 结合其他分析工具`
                }
            ];
            
            const sample = samples[Math.floor(Math.random() * samples.length)];
            
            // 选择分类
            document.querySelectorAll('.category-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.textContent === sample.category) {
                    opt.classList.add('selected');
                }
            });
            
            document.getElementById('title').value = sample.title;
            document.getElementById('summary').value = sample.summary;
            document.getElementById('difficulty').value = sample.difficulty;
            document.getElementById('detailContent').value = sample.content;
            
            // 添加标签
            sample.tags.forEach(tag => addTag(tag));
            
            showAlert('已生成示例数据，可以直接保存或修改后保存', 'info');
        }
        
        // 从模板导入
        function importFromTemplate() {
            const template = `# 方法论标题

## 概述
简要描述这个方法论的核心内容和价值...

## 适用场景
- 场景一：具体描述什么情况下使用
- 场景二：另一种典型应用场景
- 场景三：高级应用场景

## 核心步骤

### 步骤1：准备阶段
详细描述第一个步骤的具体操作：
- 准备工作1
- 准备工作2
- 注意事项

### 步骤2：执行阶段
详细描述第二个步骤的具体操作：
- 执行要点1
- 执行要点2
- 常见问题及解决方案

### 步骤3：评估阶段
详细描述第三个步骤的具体操作：
- 评估标准
- 改进建议
- 后续行动

## 实践案例

### 案例1：[案例标题]
具体描述一个真实的应用案例，包括：
- 背景情况
- 应用过程
- 取得效果
- 经验总结

### 案例2：[案例标题]
另一个应用案例...

## 注意事项
- ⚠️ 重要注意事项1
- ⚠️ 常见错误和避免方法
- ⚠️ 使用限制和条件

## 相关资源
- 📚 推荐阅读：《相关书籍》
- 🔗 相关链接：[有用的网站]
- 🛠️ 推荐工具：具体工具名称
- 📝 模板下载：相关模板文件`;

            document.getElementById('detailContent').value = template;
            showAlert('已导入标准模板，请根据实际情况修改内容', 'info');
        }
        
        // 筛选内容
        function filterContent() {
            const searchTerm = document.getElementById('searchContent').value.toLowerCase();
            const items = document.querySelectorAll('.content-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // 更新统计信息
        function updateStats() {
            document.getElementById('totalCount').textContent = methodologies.length;
            document.getElementById('categoryCount').textContent = categories.length;
            
            if (methodologies.length > 0) {
                const avgRating = methodologies.reduce((sum, m) => sum + (m.rating || 4), 0) / methodologies.length;
                document.getElementById('avgRating').textContent = avgRating.toFixed(1);
            } else {
                document.getElementById('avgRating').textContent = '0';
            }
        }
        
        // 更新进度条
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }
        
        // 显示提示信息
        function showAlert(message, type) {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.display = 'none';
            });
            
            const alert = document.getElementById(type + 'Alert');
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
        
        // 获取示例数据（离线模式使用）
        function getSampleData() {
            return [
                {
                    id: 'prod_001',
                    category: '产品设计',
                    title: '用户故事地图方法',
                    summary: '通过用户故事地图来梳理产品功能优先级和用户旅程的系统性方法',
                    difficulty: 'intermediate',
                    tags: ['用户体验', '产品规划', '敏捷开发'],
                    rating: 4.5,
                    updatedAt: '2024-01-15'
                },
                {
                    id: 'analysis_001',
                    category: '分析框架',
                    title: 'SWOT分析法',
                    summary: '系统分析优势、劣势、机会、威胁的经典战略分析工具',
                    difficulty: 'beginner',
                    tags: ['战略分析', '决策工具'],
                    rating: 4.0,
                    updatedAt: '2024-01-12'
                }
            ];
        }
        
        // ============= 图片处理功能 =============
        
        let currentImageData = null;
        
        // 插入Markdown格式文本
        function insertMarkdown(before, after) {
            const textarea = document.getElementById('detailContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            const newText = before + selectedText + after;
            textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
            
            // 重新设置光标位置
            const newCursorPos = start + before.length + selectedText.length + after.length;
            textarea.focus();
            textarea.setSelectionRange(newCursorPos, newCursorPos);
        }
        
        // 处理图片上传
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // 验证文件类型
            if (!file.type.startsWith('image/')) {
                showAlert('请选择图片文件', 'error');
                return;
            }
            
            // 验证文件大小 (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showAlert('图片大小不能超过5MB', 'error');
                return;
            }
            
            // 读取文件并预览
            const reader = new FileReader();
            reader.onload = function(e) {
                currentImageData = {
                    name: file.name,
                    data: e.target.result,
                    size: file.size
                };
                
                showImagePreview(e.target.result, file.name);
            };
            reader.readAsDataURL(file);
            
            // 清空input以允许重复选择同一文件
            event.target.value = '';
        }
        
        // 显示图片预览
        function showImagePreview(imageData, fileName) {
            const previewArea = document.getElementById('imagePreviewArea');
            const previewContent = document.getElementById('imagePreviewContent');
            
            previewContent.innerHTML = `
                <div class="image-insert-hint">
                    💡 图片将以Base64格式嵌入到文档中，建议图片大小控制在1MB以内以获得更好的性能。
                </div>
                <img src="${imageData}" alt="${fileName}" />
                <div style="margin-top: 15px; font-size: 13px; color: #64748b; text-align: left;">
                    <strong>文件信息:</strong><br>
                    📁 文件名: ${fileName}<br>
                    📊 大小: ${formatFileSize(currentImageData.size)}<br>
                    📏 格式: ${fileName.split('.').pop().toUpperCase()}
                </div>
            `;
            
            previewArea.style.display = 'block';
            previewArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // 插入选中的图片
        function insertSelectedImage() {
            if (!currentImageData) {
                showAlert('没有选择图片', 'error');
                return;
            }
            
            const altText = prompt('请输入图片描述（用于SEO和无障碍访问）:', currentImageData.name.replace(/\.[^/.]+$/, ""));
            const description = altText || currentImageData.name.replace(/\.[^/.]+$/, "");
            
            const markdownImage = `![${description}](${currentImageData.data})`;
            
            // 插入到光标位置
            const textarea = document.getElementById('detailContent');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            // 确保图片前后有换行
            let insertText = markdownImage;
            if (textBefore && !textBefore.endsWith('\n')) {
                insertText = '\n\n' + insertText;
            }
            if (textAfter && !textAfter.startsWith('\n')) {
                insertText = insertText + '\n\n';
            }
            
            textarea.value = textBefore + insertText + textAfter;
            
            // 设置光标到图片后面
            const newCursorPos = cursorPos + insertText.length;
            textarea.focus();
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            
            closeImagePreview();
            showAlert('图片插入成功！图片已嵌入到内容中', 'success');
        }
        
        // 插入图片URL
        function insertImageUrl() {
            const imageUrl = prompt('请输入图片URL地址:', 'https://');
            if (!imageUrl || imageUrl === 'https://') return;
            
            const altText = prompt('请输入图片描述（用于SEO和无障碍访问）:', '图片');
            const description = altText || '图片';
            
            const markdownImage = `![${description}](${imageUrl})`;
            
            // 插入到光标位置
            const textarea = document.getElementById('detailContent');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            // 确保图片前后有换行
            let insertText = markdownImage;
            if (textBefore && !textBefore.endsWith('\n')) {
                insertText = '\n\n' + insertText;
            }
            if (textAfter && !textAfter.startsWith('\n')) {
                insertText = insertText + '\n\n';
            }
            
            textarea.value = textBefore + insertText + textAfter;
            
            // 设置光标到图片后面
            const newCursorPos = cursorPos + insertText.length;
            textarea.focus();
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            
            showAlert('图片链接插入成功！', 'success');
        }
        
        // 关闭图片预览
        function closeImagePreview() {
            document.getElementById('imagePreviewArea').style.display = 'none';
            currentImageData = null;
        }
        
        // 预览Markdown内容
        function previewMarkdown() {
            const content = document.getElementById('detailContent').value;
            if (!content.trim()) {
                showAlert('没有内容可预览', 'info');
                return;
            }
            
            // 简单的Markdown渲染
            const htmlContent = content
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                .replace(/!\[(.*?)\]\((.*?)\)/gim, '<img src="$2" alt="$1" style="max-width: 100%; height: auto; margin: 20px auto; display: block; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.15);" />')
                .replace(/^\- (.*$)/gim, '<li>$1</li>')
                .replace(/\n/gim, '<br>');
            
            // 包装列表项
            const wrappedContent = htmlContent.replace(/(<li>.*<\/li>)/gim, '<ul>$1</ul>');
            
            const previewWindow = window.open('', '_blank', 'width=900,height=700');
            previewWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>方法论内容预览</title>
                    <style>
                        body { 
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
                            line-height: 1.8; 
                            max-width: 900px; 
                            margin: 0 auto; 
                            padding: 30px; 
                            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                            color: #2d3748;
                        }
                        .preview-container {
                            background: white;
                            padding: 40px;
                            border-radius: 16px;
                            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
                            backdrop-filter: blur(10px);
                        }
                        h1, h2, h3 { 
                            color: #2c3e50; 
                            margin-top: 30px; 
                            margin-bottom: 20px;
                            font-weight: 600;
                        }
                        h1 { 
                            font-size: 32px; 
                            border-bottom: 3px solid #667eea; 
                            padding-bottom: 15px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            background-clip: text;
                        }
                        h2 { font-size: 26px; color: #667eea; }
                        h3 { font-size: 22px; color: #764ba2; }
                        ul { padding-left: 25px; margin: 15px 0; }
                        li { margin: 12px 0; }
                        img { 
                            border: 2px solid #e1e8ed;
                            transition: transform 0.3s ease;
                        }
                        img:hover {
                            transform: scale(1.02);
                        }
                        strong { 
                            color: #667eea; 
                            font-weight: 600;
                        }
                        em {
                            color: #764ba2;
                            font-style: italic;
                        }
                        .preview-header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 2px solid #f0f2f5;
                        }
                    </style>
                </head>
                <body>
                    <div class="preview-container">
                        <div class="preview-header">
                            <h1 style="border: none; padding: 0; margin: 0;">📖 方法论内容预览</h1>
                            <p style="color: #64748b; margin: 10px 0 0 0;">实时预览 - ${new Date().toLocaleString()}</p>
                        </div>
                        ${wrappedContent}
                    </div>
                </body>
                </html>
            `);
        }
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // ============= 增强编辑功能 - 方法论专用 =============
        
        let previewMode = false;
        
        // 插入有序列表
        function insertOrderedList() {
            const newText = '1. ';
            insertMarkdown(newText, '');
        }
        
        // 插入代码块
        function insertCodeBlock() {
            const codeBlock = '\n```\n代码内容\n```\n';
            insertMarkdown('', codeBlock);
        }
        
        // 插入表格
        function insertTable() {
            const table = `
| 步骤 | 说明 | 注意事项 |
|------|------|----------|
| 1 | 第一步操作 | 重要提醒 |
| 2 | 第二步操作 | 重要提醒 |
| 3 | 第三步操作 | 重要提醒 |
`;
            insertMarkdown('', table);
        }
        
        // 插入链接
        function insertLink() {
            const url = prompt('请输入链接地址:', 'https://');
            if (!url || url === 'https://') return;
            
            const text = prompt('请输入链接文字:', '参考资料');
            const linkMarkdown = `[${text || '参考资料'}](${url})`;
            
            insertMarkdown('', linkMarkdown);
        }
        
        // 插入分隔线
        function insertSeparator() {
            insertMarkdown('\n---\n', '');
        }
        
        // 插入表情
        function insertEmoji() {
            const emojis = ['💡', '⚠️', '✅', '❌', '📝', '🔥', '⭐', '💯', '🎯', '📊', '🚀', '💪'];
            const selectedEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            insertMarkdown(selectedEmoji + ' ', '');
        }
        
        // 切换预览模式
        function togglePreview() {
            const textarea = document.getElementById('detailContent');
            
            if (!document.getElementById('previewSection')) {
                // 创建预览区域
                const previewSection = document.createElement('div');
                previewSection.id = 'previewSection';
                previewSection.className = 'preview-section';
                previewSection.style.display = 'none';
                previewSection.innerHTML = `
                    <h3 style="color: #667eea; margin-bottom: 15px;">📖 方法论预览</h3>
                    <div id="previewContent" class="preview-content"></div>
                `;
                textarea.parentNode.insertBefore(previewSection, textarea.nextSibling);
            }
            
            const previewSection = document.getElementById('previewSection');
            
            previewMode = !previewMode;
            
            if (previewMode) {
                // 显示预览
                previewSection.style.display = 'block';
                textarea.style.display = 'none';
                
                // 渲染内容
                const content = textarea.value;
                const htmlContent = renderMethodologyContent(content);
                document.getElementById('previewContent').innerHTML = htmlContent;
                
                // 更新按钮状态
                document.querySelector('.toolbar-btn-preview').textContent = '✏️';
                document.querySelector('.toolbar-btn-preview').title = '编辑模式';
            } else {
                // 显示编辑器
                previewSection.style.display = 'none';
                textarea.style.display = 'block';
                
                // 更新按钮状态
                document.querySelector('.toolbar-btn-preview').textContent = '👁️';
                document.querySelector('.toolbar-btn-preview').title = '实时预览';
            }
        }
        
        // 插入方法论专用模板
        function insertMethodologyTemplate(type) {
            const templates = {
                framework: `# 🏗️ ${document.getElementById('title').value || '方法论框架'}

## 📋 框架概述
这是一个系统性的方法论框架，用于解决特定类型的问题...

## 🎯 适用范围
- **适用场景1**：具体描述何时使用
- **适用场景2**：另一种典型场景
- **适用场景3**：高级应用场景

## 🏗️ 框架结构

### 核心组件
1. **组件A**：核心功能说明
2. **组件B**：辅助功能说明
3. **组件C**：支撑功能说明

### 组件关系
> 描述各组件之间的相互关系和依赖

## 📊 评估维度
| 维度 | 权重 | 评分标准 |
|------|------|----------|
| 有效性 | 30% | 1-5分评价标准 |
| 可操作性 | 25% | 1-5分评价标准 |
| 成本效益 | 25% | 1-5分评价标准 |
| 风险控制 | 20% | 1-5分评价标准 |

## ⚠️ 应用注意事项
- **重要提醒1**：关键注意点
- **重要提醒2**：常见误区
- **重要提醒3**：成功要素`,

                process: `# ⚙️ ${document.getElementById('title').value || '执行流程'}

## 🎯 流程目标
明确描述此流程要达到的具体目标...

## 📋 前置条件
在开始执行此流程前，需要确保：
- [ ] 条件1：具体要求
- [ ] 条件2：具体要求
- [ ] 条件3：具体要求

## ⚙️ 详细步骤

### 第一阶段：准备阶段
**目标**：完成流程启动的必要准备

1. **步骤1.1**：具体操作说明
   - 具体执行内容
   - 预期结果
   - 时间要求：X小时/天

2. **步骤1.2**：具体操作说明
   - 具体执行内容
   - 预期结果
   - 时间要求：X小时/天

### 第二阶段：执行阶段
**目标**：核心功能的具体实施

1. **步骤2.1**：具体操作说明
   - 具体执行内容
   - 预期结果
   - 时间要求：X小时/天

2. **步骤2.2**：具体操作说明
   - 具体执行内容
   - 预期结果
   - 时间要求：X小时/天

### 第三阶段：验证阶段
**目标**：确保流程执行效果

1. **步骤3.1**：效果验证
2. **步骤3.2**：问题修正
3. **步骤3.3**：结果确认

## 📊 关键指标
- **效率指标**：具体数值目标
- **质量指标**：具体数值目标
- **成本指标**：具体数值目标

## 🚨 风险控制
| 风险点 | 发生概率 | 影响程度 | 应对措施 |
|--------|----------|----------|----------|
| 风险1 | 高/中/低 | 高/中/低 | 具体应对方案 |
| 风险2 | 高/中/低 | 高/中/低 | 具体应对方案 |`,

                analysis: `# 🔍 ${document.getElementById('title').value || '分析方法'}

## 📊 分析目标
明确本分析方法要解决的核心问题...

## 🔍 分析维度

### 维度1：[维度名称]
**分析重点**：具体分析什么
**关键指标**：
- 指标1：计算方法和标准
- 指标2：计算方法和标准
- 指标3：计算方法和标准

### 维度2：[维度名称]
**分析重点**：具体分析什么
**关键指标**：
- 指标1：计算方法和标准
- 指标2：计算方法和标准

### 维度3：[维度名称]
**分析重点**：具体分析什么
**关键指标**：
- 指标1：计算方法和标准
- 指标2：计算方法和标准

## 📈 分析步骤

### 步骤1：数据收集
1. **内部数据**：
   - 数据源1：获取方式
   - 数据源2：获取方式
   
2. **外部数据**：
   - 数据源1：获取方式
   - 数据源2：获取方式

### 步骤2：数据处理
1. **数据清洗**：去除异常值、补充缺失值
2. **数据标准化**：统一格式和单位
3. **数据验证**：确保数据准确性

### 步骤3：分析执行
1. **定量分析**：
   - 计算各维度指标
   - 进行趋势分析
   - 执行对比分析

2. **定性分析**：
   - 识别关键因素
   - 分析因果关系
   - 评估影响程度

### 步骤4：结果解读
1. **数据可视化**：制作图表展示
2. **洞察提取**：总结关键发现
3. **建议制定**：提出改进方案

## 📋 分析模板

| 分析项目 | 当前状况 | 目标状况 | 差距分析 | 改进建议 |
|----------|----------|----------|----------|----------|
| 项目1 | 现状描述 | 目标描述 | 差距说明 | 具体建议 |
| 项目2 | 现状描述 | 目标描述 | 差距说明 | 具体建议 |

## 💡 分析技巧
- **技巧1**：具体说明
- **技巧2**：具体说明
- **技巧3**：具体说明`,

                design: `# 🎨 ${document.getElementById('title').value || '设计方法'}

## 🎯 设计目标
明确设计要达到的核心目标和用户价值...

## 👥 目标用户
### 主要用户群体
- **用户群体1**：特征描述、需求分析
- **用户群体2**：特征描述、需求分析
- **用户群体3**：特征描述、需求分析

### 用户场景
1. **场景1**：具体使用情境
2. **场景2**：具体使用情境
3. **场景3**：具体使用情境

## 🎨 设计原则
1. **原则1**：具体说明和应用方式
2. **原则2**：具体说明和应用方式
3. **原则3**：具体说明和应用方式
4. **原则4**：具体说明和应用方式

## 🔄 设计流程

### 阶段1：需求分析 (1-2天)
- [ ] 用户研究
- [ ] 需求梳理
- [ ] 优先级排序

### 阶段2：概念设计 (2-3天)
- [ ] 头脑风暴
- [ ] 概念草图
- [ ] 方案筛选

### 阶段3：详细设计 (3-5天)
- [ ] 交互设计
- [ ] 视觉设计
- [ ] 原型制作

### 阶段4：测试迭代 (1-2天)
- [ ] 用户测试
- [ ] 反馈收集
- [ ] 设计优化

## 📊 设计评估

### 评估维度
| 维度 | 权重 | 评分标准 (1-5分) |
|------|------|------------------|
| 易用性 | 30% | 用户能否轻松完成任务 |
| 美观性 | 25% | 视觉设计是否吸引人 |
| 功能性 | 25% | 功能是否完整有效 |
| 一致性 | 20% | 设计是否保持一致 |

### 成功指标
- **用户满意度**：目标 ≥ 4.0/5.0
- **任务完成率**：目标 ≥ 90%
- **操作效率**：目标提升 30%

## 🛠️ 设计工具
- **原型工具**：推荐工具和使用方法
- **设计工具**：推荐工具和使用方法
- **测试工具**：推荐工具和使用方法

## ⚠️ 设计注意事项
- **可访问性**：确保所有用户都能使用
- **响应式**：适配不同设备屏幕
- **性能优化**：保证加载速度和流畅性`,

                management: `# 📊 ${document.getElementById('title').value || '管理方法'}

## 🎯 管理目标
明确此管理方法要达到的核心目标...

## 📋 管理范围
### 管理对象
- **对象1**：具体说明管理内容
- **对象2**：具体说明管理内容
- **对象3**：具体说明管理内容

### 管理层级
1. **战略层**：长期规划和方向制定
2. **战术层**：中期计划和资源配置
3. **执行层**：日常操作和任务执行

## 📊 管理体系

### 组织架构
\`\`\`
管理层
├── 部门A (负责人：xxx)
├── 部门B (负责人：xxx)
└── 部门C (负责人：xxx)
\`\`\`

### 职责分工
| 角色 | 主要职责 | 权限范围 | 汇报关系 |
|------|----------|----------|----------|
| 管理者 | 整体规划和决策 | 全权管理 | 向上级汇报 |
| 协调者 | 跨部门协调 | 协调权限 | 向管理者汇报 |
| 执行者 | 具体任务执行 | 执行权限 | 向协调者汇报 |

## 🔄 管理流程

### 计划阶段
1. **目标设定**：SMART原则制定具体目标
2. **资源规划**：评估和分配必要资源
3. **时间安排**：制定详细时间表
4. **风险评估**：识别潜在风险和应对措施

### 执行阶段
1. **任务分配**：明确责任人和截止时间
2. **进度跟踪**：定期检查执行进度
3. **问题解决**：及时处理出现的问题
4. **资源调整**：根据实际情况调整资源

### 监控阶段
1. **关键指标监控**：
   - 进度指标：完成率、时间进度
   - 质量指标：错误率、返工率
   - 成本指标：预算执行、成本控制

2. **定期评估**：
   - 周例会：解决日常问题
   - 月度评估：总结经验教训
   - 季度回顾：调整策略方向

### 改进阶段
1. **数据分析**：分析各项指标数据
2. **问题识别**：找出管理中的不足
3. **方案制定**：制定改进计划
4. **实施跟踪**：确保改进措施落地

## 📈 绩效考核

### 考核指标
| 类别 | 指标名称 | 权重 | 计算方法 | 目标值 |
|------|----------|------|----------|--------|
| 效率 | 任务完成率 | 30% | 实际完成/计划任务 | ≥95% |
| 质量 | 质量达标率 | 25% | 合格数量/总数量 | ≥98% |
| 成本 | 成本控制率 | 25% | 实际成本/预算成本 | ≤100% |
| 创新 | 改进提案数 | 20% | 采纳提案数/总提案数 | ≥80% |

### 激励机制
- **正向激励**：奖金、晋升、表彰等
- **负向激励**：警告、培训、调岗等

## 🛠️ 管理工具
- **项目管理**：推荐的项目管理工具
- **沟通协作**：推荐的沟通工具
- **数据分析**：推荐的分析工具

## ⚠️ 管理注意事项
- **灵活性**：根据实际情况调整管理方式
- **人性化**：关注团队成员的个人发展
- **持续改进**：定期优化管理流程和方法`
            };
            
            const template = templates[type];
            if (template) {
                const textarea = document.getElementById('detailContent');
                
                // 如果当前内容为空或者用户确认，则插入模板
                if (!textarea.value.trim() || confirm('插入模板将替换当前内容，是否继续？')) {
                    textarea.value = template;
                    textarea.focus();
                    showAlert(`已插入${getMethodologyTemplateName(type)}模板`, 'success');
                }
            }
        }
        
        // 获取方法论模板名称
        function getMethodologyTemplateName(type) {
            const names = {
                framework: '方法论框架',
                process: '执行流程',
                analysis: '分析方法',
                design: '设计方法',
                management: '管理方法'
            };
            return names[type] || '未知';
        }
        
        // 增强的方法论markdown渲染
        function renderMethodologyContent(content) {
            return content
                .replace(/^# (.*$)/gim, '<h1 style="color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 12px; margin-bottom: 20px;">$1</h1>')
                .replace(/^## (.*$)/gim, '<h2 style="color: #764ba2; margin-top: 35px; margin-bottom: 15px; font-size: 24px;">$1</h2>')
                .replace(/^### (.*$)/gim, '<h3 style="color: #667eea; margin-top: 30px; margin-bottom: 12px; font-size: 20px;">$1</h3>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong style="color: #764ba2; font-weight: 700;">$1</strong>')
                .replace(/\*(.*?)\*/gim, '<em style="color: #667eea; font-style: italic;">$1</em>')
                .replace(/~~(.*?)~~/gim, '<del style="color: #95a5a6; text-decoration: line-through;">$1</del>')
                .replace(/`(.*?)`/gim, '<code style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 3px 8px; border-radius: 6px; color: #764ba2; font-family: Monaco, monospace; font-weight: 600;">$1</code>')
                .replace(/!\[(.*?)\]\((.*?)\)/gim, '<img src="$2" alt="$1" style="max-width: 100%; height: auto; margin: 25px auto; display: block; border-radius: 12px; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2); border: 3px solid #f8f9fa;" />')
                .replace(/\[([^\]]+)\]\(([^)]+)\)/gim, '<a href="$2" style="color: #667eea; text-decoration: none; font-weight: 600; border-bottom: 2px solid rgba(102, 126, 234, 0.3);" target="_blank">$1</a>')
                .replace(/^> (.*$)/gim, '<blockquote style="border-left: 5px solid #667eea; margin: 20px 0; padding: 12px 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%); color: #2c3e50; border-radius: 0 8px 8px 0;">$1</blockquote>')
                .replace(/^- \[ \] (.*$)/gim, '<label style="display: block; margin: 10px 0; padding: 8px; background: #f8f9fa; border-radius: 6px; cursor: pointer;"><input type="checkbox" disabled style="margin-right: 10px; transform: scale(1.2);"> $1</label>')
                .replace(/^- \[x\] (.*$)/gim, '<label style="display: block; margin: 10px 0; padding: 8px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 6px; cursor: pointer;"><input type="checkbox" checked disabled style="margin-right: 10px; transform: scale(1.2);"> $1</label>')
                .replace(/^- (.*$)/gim, '<li style="margin: 10px 0; padding: 4px 0; color: #2c3e50;">$1</li>')
                .replace(/^\d+\. (.*$)/gim, '<li style="margin: 10px 0; padding: 4px 0; list-style-type: decimal; color: #2c3e50;">$1</li>')
                .replace(/^---$/gim, '<hr style="border: none; border-top: 3px solid #e9ecef; margin: 40px 0; background: linear-gradient(to right, #667eea, #764ba2);">')
                .replace(/```([\s\S]*?)```/gim, '<pre style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: #ecf0f1; padding: 20px; border-radius: 12px; overflow-x: auto; margin: 20px 0; box-shadow: 0 4px 16px rgba(0,0,0,0.1);"><code>$1</code></pre>')
                .replace(/\n/gim, '<br>');
        }
    </script>
</body>
</html> 